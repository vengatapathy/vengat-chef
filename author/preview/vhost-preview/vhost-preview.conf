<VirtualHost ${aem_Host_Name}:${aem_HTTP_Port}>
        ServerName ${preview_Host_Name}
        DocumentRoot ${aem_Cache_Folder}
        <Directory ${aem_Cache_Folder}>
                <IfModule disp_apache2.c>
                        SetHandler dispatcher-handler
                        ModMimeUsePathInfo On
                </IfModule>
                Options FollowSymLinks
                AllowOverride None
                Require all granted
        </Directory>

        RewriteEngine On
        RewriteCond %{REQUEST_METHOD} !^(GET|POST)
        RewriteRule .* - [R=405,L]

        RewriteCond %{QUERY_STRING} ^wcmmode=disabled
        RewriteRule /(.*) /$1 [QSD,R=301]

        RewriteCond %{REQUEST_URI} !^/crx/packmgr/
        RewriteRule ^/(.*)$ /$1?wcmmode=disabled [PT,L]

        Header add SM_USER "aempreview"
        RequestHeader set SM_USER "aempreview"
</VirtualHost>

<VirtualHost ${aem_Host_Name}:${aem_HTTPS_Port}>
        ServerName ${preview_Host_Name}
        DocumentRoot ${aem_Cache_Folder}
        <Directory ${aem_Cache_Folder}>
                <IfModule disp_apache2.c>
                        SetHandler dispatcher-handler
                        ModMimeUsePathInfo On
                </IfModule>
                Options FollowSymLinks
                AllowOverride None
                Require all granted
        </Directory>

        RewriteEngine On
        RewriteCond %{REQUEST_METHOD} !^(GET|POST)
        RewriteRule .* - [R=405,L]

        RewriteRule (.*)\/ns\/(.*) http://${preview_Host_Name}\/$2 [L,R=301,QSD]
        RewriteCond %{QUERY_STRING} ^wcmmode=disabled
        RewriteRule ^/(.*) /$1 [QSD,R=301]

        RewriteRule ^/(.*).html$ /$1.secure.html?wcmmode=disabled [PT,L]

        Header add SM_USER "aempreview"
        RequestHeader set SM_USER "aempreview"

        SSLEngine on
        SSLCertificateFile /app1/dmp/dispatcher/cert/wildcard-dmp.aig.net_sha256/wildcard-dmp.aig.net.crt
        SSLCertificateKeyFile /app1/dmp/dispatcher/cert/wildcard-dmp.aig.net_sha256/wildcard-dmp.aig.net.key
        SSLCertificateChainFile /app1/dmp/dispatcher/cert/wildcard-dmp.aig.net_sha256/GeoTrustCA.crt
        SSLCipherSuite ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4
        #SSLCipherSuite AES128-SHA:AES256-SHA
        SSLProtocol All -SSLv2 -SSLv3
</VirtualHost>
